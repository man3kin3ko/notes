Security Code Review должен встраиваться в существующий процесс code review. Как правило, это происходит на на 2 (Repeatable) и 3 (Defined) уровне зрелости CMM (The capability mature model).

Код ревью является формальным этапом любого S-SDLC (XP, Agile, BSIMM, CMMI).

Если у компании есть правила оформления кода (coding guidelines), то ревьювер может отказать в аудите, если код им не соответствует.

Качественная характеристика хорошего код ревью - тестирование на проникновение не должно находить большее число багов, чем на код ревью.

Для ревьювера необходимо предоставить:
- бизнес правила и органичения
- roadmap разработки для выявления потенциального влияния существующих багов
- модель угроз

## Создание модели угроз
### Декомпозиция

Необходимо составить контекстную диаграмму для выявления существующих связей с внешними системами, диаграмму компонентов приложения (обычно в формате UML), диаграмму потоков данных (DFD). Также должно быть предоставлено описание бизнес-процессов (use-cases) приложения. Это помогает сформулировать: а) активы, подлежащие защите б) точки входа в приложение в) границы доверия

Затем провести SCA-анализ (зависимостей).

Если есть какие-то требования к деплою приложения, диктуемые фреймворком или другими требованиями, это должно быть задокументированно на текущем этапе.

Определить поверхность атаки:

- Входные параметры конфигураций
- Пользовательский ввод
- Куки, заголовки middleware, ответы внешних систем

### Транзакционный анализ

Транзакционный анализ включает в себя изучение взаимодействий и транзакций между различными компонентами системы, пользователями или сторонними сервисами.

Примерами таких компонентов являются:
- Валидация
- Аутентификация и авторизация
- Менеджмент сессий
- Криптография
- Обработка ошибок
- Логгирование
### Классификация и оценка угроз

Выбрать модель угроз, оценить их в соответствии с моделью.

## Метрики 

#### LOC - Lines of code

Вспомогательная величина

#### Function point

Может быть такой структурной единицей, как класс, модуль или функция

#### Defect density

Величина для получения высокоуровневой оценки, но не для принятия решений

```
number of vulnerabilities / LOC
```

#### Risk density
```
risk = cost * probability

RD(severity) = risk / LOC
RD(severity) = risk / Function point
```

#### Cyclomatic complexity (CC)

Cyclomatic complexity - это количественная мера сложности программного кода. Она оценивает количество путей через код. В участках кода с большей цикломатической сложностью выше вероятность возникновения багов. Эта метрика позволяет внедрить риско-ориентированный подход при планировании порядка проведения аудита, то есть начинать анализ с наиболее потенциально проблемных участков.
  
Эта метрика измеряется путем подсчета количества линейных независимых путей через исходный код программы. Обычно Cyclomatic complexity вычисляется путем подсчета количества решающих блоков (условных операторов, циклов и т. д.) и добавления единицы к этому числу.

#### Bad Fix Probability
Вероятность регрессии кода в результате исправления бага.

|CC|Bad fix probability|
|---|---|
|1–10|5%|
|20–30|20%|
|>50|40%|
|approaching 100|60%|

#### Inspection rate

Приблизительная величина для оценки времени, необходимого на аудит кода (но не его качества). Измеряется в величинах кода (LOC, Function point) на час времени одного ревьювера. Например: 250 строк в час.

#### Defect detection rate

Аналогичная величина, равная числу найденных уязвимостей на единицу кода. Имеет обратную зависимость от inspection rate :^)

## Code crawling

Практика мануального/полуавтоматического поиска точек входа в коде приложения. Грепаются стандартные функции и объекты, такие, как `$_GET[` в PHP, `postMessage()` в JS и другие.